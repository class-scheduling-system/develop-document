# 自动排课设计

## 1. 功能概述

自动排课功能基于学校的课程安排需求，结合课程信息、教师空闲时间、教室资源及学生班级等数据库内容，通过优化算法生成无冲突且高效的课表。主要目标包括：

- 动态生成满足约束条件的课程表。
- 支持多角色（管理员、教师、学生）协作与操作。
- 提供冲突检测与智能优化功能。
- 输出课表结果并支持导出（如 PDF、Excel）。

---

## 2. 系统架构

### 2.1 模块划分

系统架构包含以下模块：

1. **数据输入模块**：从数据库中获取课程、教师、教室、班级及时间表等数据。
2. **规则引擎模块**：定义并验证约束条件（时间冲突、教室容量等）。
3. **排课算法模块**：基于遗传算法生成初始课表，并通过迭代优化。
4. **冲突检测模块**：检测生成方案中的时间冲突、资源冲突及学生冲突。
5. **可视化模块**：提供课表的日历视图和冲突报告。
6. **数据输出模块**：支持课表的导出和分发。

---

## 3. 设计目标与约束条件

### 3.1 设计目标

1. **数据一致性**：确保生成的课表符合数据库的外键关系及约束条件。
2. **动态性**：支持实时调整参数（如课程优先级、教师偏好）。
3. **兼容性**：满足多校区、多教学楼、多学科的排课需求。

### 3.2 数据库约束映射

#### 课程相关

- **课程表（`cs_course_library`）**：
    - **约束**：课程编号唯一；类别、属性、类型需外键关联。
    - **实现要求**：
        - 每门课程必须与教师及班级绑定。
        - 支持不同类型课程的排课优先级调整（如实验课优先分配实验室）。

#### 教师相关

- **教师表（`cs_teacher`）**：
    - **约束**：工号唯一；需关联学院信息。
    - **实现要求**：
        - 同一时间段内，教师只能安排一门课程。
        - 支持教师的空闲时间与偏好配置。

#### 教室相关

- **教室表（`cs_classroom`）**：
    - **约束**：教室编号唯一；需关联类型和标签。
    - **实现要求**：
        - 教室分配需考虑容量和类型匹配（如大班课程需分配大教室）。
        - 避免同一时间段内多门课程使用同一教室。

#### 学生相关

- **学生表（`cs_student`）**：
    - **约束**：学号唯一；需关联班级信息。
    - **实现要求**：
        - 避免同一班级的学生在同一时间段安排多门课程。
        - 优化课程间的间隔时间，减少学生的空闲时间。

#### 时间表相关

- **时间表（`cs_timetable`）**：
    - **约束**：时间段编号唯一；需与学期表关联。
    - **实现要求**：
        - 避免节假日或非教学时间段安排课程。
        - 支持动态调整学期时间范围。

---

## 4. 核心算法设计

### 4.1 算法选择

- **遗传算法**：
    - 遗传算法适用于解决复杂的约束优化问题，特别是多约束的自动排课。
    - **编码**：使用多维数组表示课表，每个基因对应一门课程的安排（教师、教室、时间段）。
    - **适应度函数**：
        - 时间冲突：相同时间段的同一教师或教室安排重复课程，降低适应度。
        - 教室匹配度：课程需求与教室容量、类型不符时，降低适应度。
        - 优先级：根据课程优先级动态调整适应度分值。
    - **交叉与变异**：
        - 交叉操作：交换两课表方案的部分课程安排，生成新方案。
        - 变异操作：随机调整部分课程的时间或教室安排，探索解空间。

### 4.2 冲突检测

- **时间冲突**：
    - 检查同一时间段是否有重复安排的课程。
- **教室冲突**：
    - 检查同一教室是否在同一时间段分配给多门课程。
- **学生冲突**：
    - 检查同一班级的学生是否同时被安排多门课程。

---

## 5. 数据结构设计

### 5.1 输入数据

| 数据类型     | 字段                     | 描述                           |
| ------------ | ------------------------ | ------------------------------ |
| 课程信息     | 课程编号、课程名称       | 每门课程的唯一标识及名称。     |
| 教师信息     | 教师编号、姓名、空闲时间 | 教师的基础信息及可授课时间段。 |
| 教室信息     | 教室编号、容量、类型     | 教室的基础信息及资源描述。     |
| 学生班级信息 | 班级编号、班级名称       | 学生所在班级的唯一标识及名称。 |
| 时间表       | 时间段编号、时间范围     | 学校的时间安排基准。           |

### 5.2 输出数据

| 数据类型     | 字段                         | 描述                           |
| ------------ | ---------------------------- | ------------------------------ |
| 排课结果     | 课程名称、教师、教室、时间段 | 最终生成的无冲突排课方案。     |
| 冲突检测报告 | 冲突类型、冲突描述、解决建议 | 排课冲突检测的结果及调整建议。 |

---

## 6. 可视化设计

- **图形化展示**：
    - 以周视图、日历视图形式展示课表结果。
    - 使用颜色区分课程类型和状态（已排课程、冲突课程等）。
- **交互功能**：
    - 支持拖拽调整课程安排。
    - 提供冲突高亮和调整建议。

---

## 7. 测试与优化

### 7.1 测试场景

1. **功能测试**：
      - 验证排课结果是否符合课程、教师、教室及学生的约束条件。
      - 验证冲突检测模块的准确性。
2. **性能测试**：
      - 测试在大规模数据条件下的运行效率。
      - 模拟高并发环境，验证系统的稳定性。

### 7.2 优化方向

- 调整适应度函数参数，提升排课结果的合理性。
- 采用多线程或分布式计算，减少计算时间。

---

## 8. 部署与维护

- **部署环境**：
    - 后端：Spring Boot 提供 API 接口。
    - 前端：React 提供用户交互界面。
    - 数据库：MySQL 与 Redis 支持数据存储与缓存。
- **维护计划**：
    - 定期优化冲突检测规则。
    - 根据反馈调整算法参数与权重。

---

## 9. 总结

本设计文档基于数据库约束条件，提供了清晰的功能模块划分和实现方案，同时在算法设计和冲突检测方面增强了针对性与灵活性，确保系统的稳定性和扩展性。